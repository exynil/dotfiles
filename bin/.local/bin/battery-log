#!/bin/bash
#
# Скрипт для мониторинга состояния батареи ноутбука.
# Собирает данные о текущей емкости, проектной емкости и проценте износа батареи.
# Записывает данные в лог-файл один раз в день (если запись за сегодня еще не была сделана).
# Работает только на хосте arch-laptop.

if [[ $(uname -n) != "arch-laptop" ]]; then
    exit 0
fi

journal="$HDD/arch/logs/battery.log"
mkdir -p "$HDD/arch/logs"

date=$(date +'%Y-%m-%d')

if [[ -f $journal ]]; then
    last_date=$(awk 'END{print $1}' $journal)

    [[ $last_date == "$date" ]] && exit 1
fi

info='upower -i /org/freedesktop/UPower/devices/battery_BAT0'

energy_full=$($info | awk '/energy-full:/{print $2}')
energy_full_design=$($info | awk '/energy-full-design:/{print $2}')
capacity=$($info | awk '/capacity:/{print $2}')

echo "$date $energy_full $energy_full_design $capacity" >>$journal