#!/bin/bash

# Директория с изображениями
WALLPAPERS_DIR="$XDG_PICTURES_DIR/wallpapers"

CURRENT_LINK="$XDG_PICTURES_DIR/wallpaper.jpg"

# Получаем все изображения в папке, исключая папку temp
wallpapers=($(find "$WALLPAPERS_DIR" -type f ! -path "$WALLPAPERS_DIR/temp/*" | sort))

# Находим индекс текущего изображения в списке
current_wallpaper=$(readlink -f "$CURRENT_LINK")
current_index=-1

for i in "${!wallpapers[@]}"; do
    if [[ "${wallpapers[$i]##*/}" == "${current_wallpaper##*/}" ]]; then
        current_index=$i
        break
    fi
done

# Проверка аргумента
if [[ $# -ne 1 || ! "$1" =~ ^(next|prev)$ ]]; then
    echo "Usage: $0 {next|prev}"
    exit 1
fi

# Логика переключения
if [[ "$1" == "next" ]]; then
    new_index=$(((current_index + 1) % ${#wallpapers[@]}))
elif [[ "$1" == "prev" ]]; then
    new_index=$(((current_index - 1 + ${#wallpapers[@]}) % ${#wallpapers[@]}))
fi

# Получаем новый файл
new_wallpaper="${wallpapers[$new_index]}"

# Устанавливаем новое изображение как обои
set-wallpaper "$new_wallpaper"
