#!/bin/bash

# Проверяем, передан ли аргумент
if [ -z "$1" ]; then
  echo "Использование: gfiles <количество> <расширение> [<количество> <расширение> ...]"
  echo "Пример: gfiles 20 mp3 40 txt"
  exit 1
fi

# Проверяем, что количество аргументов четное
if [ $(($# % 2)) -ne 0 ]; then
  echo "Ошибка: Количество аргументов должно быть четным (пары: количество расширение)"
  exit 1
fi

# Размер файла 20 КБ
filesize=20480

# Подсчитываем общее количество файлов
total_files=0
args=("$@")
for ((i=0; i<${#args[@]}; i+=2)); do
    total_files=$((total_files + ${args[i]}))
done

# Определяем ширину нумерации на основе общего количества файлов
if [ $total_files -lt 10 ]; then
    width=1
elif [ $total_files -lt 100 ]; then
    width=2
elif [ $total_files -lt 1000 ]; then
    width=3
elif [ $total_files -lt 10000 ]; then
    width=4
else
    width=5
fi

# Счетчик для сквозной нумерации
counter=1

# Обрабатываем аргументы попарно
while [ $# -gt 0 ]; do
    N=$1
    ext=$2

    # Проверяем, что количество - это число
    if ! [[ "$N" =~ ^[0-9]+$ ]]; then
        echo "Ошибка: '$N' не является числом"
        exit 1
    fi

    # Генерируем файлы
    for ((i=1; i<=N; i++))
    do
        # Форматируем номер файла с ведущими нулями
        filename=$(printf "%0${width}d.%s" "$counter" "$ext")

        # Заполняем файл случайными данными, чтобы его размер был 20 КБ
        base64 /dev/urandom | head -c "$filesize" > "$filename"


        # Увеличиваем счетчик
        ((counter++))
    done

    # Переходим к следующей паре аргументов
    shift 2
done

echo "Генерация завершена!"
